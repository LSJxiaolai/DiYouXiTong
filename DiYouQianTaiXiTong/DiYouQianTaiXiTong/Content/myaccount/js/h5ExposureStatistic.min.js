(function () {
    var b = {
        getClientHeight:
            function () {
                var c = 0; if (document.body.clientHeight && document.documentElement.clientHeight) { c = (document.body.clientHeight < document.documentElement.clientHeight) ? document.body.clientHeight : document.documentElement.clientHeight } else { c = (document.body.clientHeight > document.documentElement.clientHeight) ? document.body.clientHeight : document.documentElement.clientHeight } return c
            }, getClientWidth: function () { var c = 0; if (document.body.clientWidth && document.documentElement.clientWidth) { c = (document.body.clientWidth < document.documentElement.clientWidth) ? document.body.clientWidth : document.documentElement.clientWidth } else { c = (document.body.clientWidth > document.documentElement.clientWidth) ? document.body.clientWidth : document.documentElement.clientWidth } return c }, getScrollTop: function () { var c = 0; if (document.documentElement && document.documentElement.scrollTop) { c = document.documentElement.scrollTop } else { if (document.body) { c = document.body.scrollTop } } return c }, getScrollHeight: function () { return Math.max(document.body.scrollHeight, document.documentElement.scrollHeight) }, getCookie: function (f) { var d = f + "="; var h = d.length; var c = document.cookie.length; var g = 0; while (g < c) { var e = g + h; if (document.cookie.substring(g, e) == d) { return this.getCookieValue(e) } g = document.cookie.indexOf(" ", g) + 1; if (g == 0) { break } } return null }, getCookieValue: function (d) { var c = document.cookie.indexOf(";", d); if (c == -1) { c = document.cookie.length } return document.cookie.substring(d, c) }, getDateStr: function (g) { var c = new Date(); c.setDate(c.getDate() + g); var e = c.getFullYear(); var f = c.getMonth() + 1; var d = c.getDate(); return e + "-" + (f < 10 ? "0" + f : f) + "-" + (d < 10 ? "0" + d : d) }, reportDataByGif: function (i) { var h = b.getCookie("__jdu"); if (h == "") { var c = b.getCookie("__jda"); if (c != "") { var g = c.split("."); h = g[1] } } var e = b.getCookie("pin"); if (!e) { e = b.getCookie("pt_pin") } if (!e) { e = b.getCookie("pwdt_id") } var f = b.getCookie("_jrda"); var k = b.getCookie("flow_site_ad"); var l = b.getCookie("flow_outsite_ad"); var m = ("https:" == document.location.protocol ? "https://" : "http://") + "jdjrflow.jd.com/log.gif?uid=" + h + "&p=" + e + "&t=www.130000&m=UA-J2011-12&ref=" + location.href + "&v=" + encodeURIComponent(i) + "&jrda=" + f + "&sitead=" + k + "&outsitead=" + l + "&rm=" + (new Date).getTime() + "&__jrrda=" + b.getCookie("__jrrda") + "&__jrrdb=" + b.getCookie("__jrrdb") + "&__jrrdc=" + b.getCookie("__jrrdc") + "&__jrrdv=" + b.getCookie("__jrrdv"); var j = new Image(1, 1); j.src = m; j.onload = function () { j.onload = null; j.onerror = null } }, touchFunc: function () { a.scrollFunc() }
    }; var a = { clstagDomObj: [], rootEle: document.body, scrollTimer: null, docClientHeight: 0, docScrollTop: 0, docScrollHeight: 0, _this: this, foreachNodes: function (g) { try { if (g.hasChildNodes) { var d = g.childNodes; for (var e = 0, c = d.length; e < c; e++) { var h = d.item(e); if ((typeof h.offsetTop !== "undefined") && (typeof h.offsetHeight !== "undefined")) { if (h.attributes.clstag) { this.clstagDomObj.push({ node: h, flag: false }) } this.foreachNodes(h) } } } } catch (f) { console.log("遍历dom节点错误  " + f.message) } }, scrollFunc: function () { var f = this, d = window.scrollY, e = window.scrollY + b.getClientHeight(), c = window.screen.availHeight; this.docClientHeight = b.getClientHeight(); this.docScrollTop = b.getScrollTop(); this.docScrollHeight = b.getScrollHeight(); if (this.docScrollTop === d) { setTimeout(function () { console.log("_this.clstagDomObj.length  " + f.clstagDomObj.length); if (f.clstagDomObj.length > 0) { var t = [], n = []; for (var m = 0, o = f.clstagDomObj.length; m < o; m++) { var l = f.clstagDomObj[m]; if (parseInt(l.node.offsetHeight) < document.body.clientHeight) { var s = l.node.getBoundingClientRect().top; var h = l.node.getBoundingClientRect().right; var g = l.node.getBoundingClientRect().bottom; var q = l.node.getBoundingClientRect().left; var k = l.node.offsetWidth; if ((s <= b.getClientHeight()) && s > 0 && (h > 0 && h <= window.screen.availWidth)) { if (l.node.attributes.clstag && !l.flag) { l.flag = true; var r = l.node.attributes.clstag.nodeValue; t.push((m + 1) + "_" + r.split("|")[2]); n.push((m + 1) + "_" + r.split("|")[3]) } } else { if (-(s) < l.node.offsetHeight && s < 0 && (h > 0 && h <= window.screen.availWidth)) { if (l.node.attributes.clstag && !l.flag) { l.flag = true; var r = l.node.attributes.clstag.nodeValue; t.push((m + 1) + "_" + r.split("|")[2]); n.push((m + 1) + "_" + r.split("|")[3]) } } } } } if (t.length > 0 && (t.length == n.length)) { var p = "bty=1$page=" + t.join(",") + "$location=" + n.join(","); try { b.reportDataByGif(p) } catch (j) { console.log("H5上报曝光数据错误  " + j.message) } } } clearTimeout(f.scrollTimer); f.scrollTimer = null }, 1000) } } }; if (/(iPhone|iPad|iPod|iOS|ios|Android|Mobile|Linux)/i.test(navigator.userAgent)) { a.foreachNodes(document.body); if (document.readyState === "complete") { a.scrollFunc() } } document.onscroll = function () { if (a.scrollTimer === null && /(iPhone|iPad|iPod|iOS|ios|Android|Mobile|Linux)/i.test(navigator.userAgent)) { a.scrollTimer = setTimeout(function () { a.scrollFunc() }, 1000) } }
})();
